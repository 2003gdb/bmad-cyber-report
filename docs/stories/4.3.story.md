# Story 4.3: Analytics and Insights Dashboard

## Status
Draft

## Story
**As a** SafeTrade administrator,
**I want** comprehensive analytics about reported threats and platform usage,
**so that** I can identify patterns, trends, and areas requiring attention or improvement.

## Acceptance Criteria
1. Interactive dashboard with key performance indicators and threat metrics
2. Time-series analysis showing threat evolution over weeks/months
3. Attack vector analysis identifying most common and dangerous threat types
4. User engagement metrics tracking platform adoption and report quality
5. Geographic analysis showing threat distribution across regions
6. Exportable reports for sharing insights with stakeholders or authorities

## Tasks / Subtasks
- [ ] Build Advanced Analytics API Endpoints (AC: 1, 2, 3, 4, 5)
  - [ ] Extend existing /admin/dashboard endpoint with comprehensive analytics data
  - [ ] Implement GET /admin/analytics endpoint with date range filtering and data aggregation
  - [ ] Add time-series analysis queries for threat evolution over configurable periods
  - [ ] Create attack vector analysis with percentage calculations and trend comparisons
  - [ ] Build user engagement metrics combining anonymous and identified report patterns
  - [ ] Implement geographic analysis using attack_origin data when available
- [ ] Create Interactive Analytics Dashboard Components (AC: 1, 2, 3)
  - [ ] Build AnalyticsGrid component displaying key performance indicators with visual cards
  - [ ] Implement TrendChart component using Rechart for time-series visualization
  - [ ] Create AttackVectorChart component showing attack type distribution and trends
  - [ ] Add interactive filtering by date range, attack type, and geographic region
  - [ ] Implement responsive chart layout using Tailwind CSS grid patterns
- [ ] Develop User Engagement and Platform Metrics (AC: 4)
  - [ ] Create UserEngagementPanel component tracking report submissions and user growth
  - [ ] Add platform adoption metrics showing anonymous vs identified reporting patterns
  - [ ] Implement report quality scoring based on completeness and detail level
  - [ ] Display monthly active user trends and reporting frequency patterns
- [ ] Build Export and Sharing Functionality (AC: 6)
  - [ ] Create ExportTools component with multiple format options (PDF, CSV, Excel)
  - [ ] Implement data export API endpoint /admin/analytics/export with format parameter
  - [ ] Add stakeholder sharing functionality with summary report generation
  - [ ] Create print-friendly analytics report layouts for authorities
- [ ] Testing for Analytics Dashboard (Testing Requirements)
  - [ ] Create unit tests for all analytics components and API integration
  - [ ] Add integration tests for dashboard data loading and chart rendering
  - [ ] Test export functionality across different data formats and date ranges
  - [ ] Verify analytics calculations and data aggregation accuracy

## Dev Notes

### Previous Story Insights
Story 4.1 completed the admin portal foundation with authentication, basic dashboard, and report management system. The Next.js admin portal architecture is established with App Router, TypeScript, and Tailwind CSS. Basic admin API endpoints (/admin/login, /admin/dashboard, /admin/reports) are implemented and ready for extension with analytics functionality.

### Data Models
- **Report model**: Complete incident data structure with attack_type, impact_level, status, incident_date, created_at fields supports comprehensive analytics [Source: architecture/data-models.md:20-42]
- **User model**: User registration and engagement tracking with created_at timestamp for platform adoption metrics [Source: architecture/data-models.md:3-19]
- **AdminUser model**: Admin access tracking with created_at timestamp for administrative analytics [Source: architecture/data-models.md:62-75]
- **Analytics aggregation**: No specific analytics tables - analytics calculated from existing Report and User data in real-time

### API Specifications
- **Extended Dashboard**: Current GET /admin/dashboard provides basic metrics (total_reports, reports_today, critical_reports, recent_trends) [Source: architecture/rest-api-spec.md:391-414]
- **New Analytics Endpoint**: GET /admin/analytics with date range parameters returning comprehensive analytics data structure
- **Export Endpoint**: GET /admin/analytics/export with format parameter (pdf, csv, xlsx) for stakeholder reporting
- **Filtering Support**: Date range, attack type, impact level, and geographic region filtering across all analytics endpoints

### Component Specifications
- **Analytics Page**: packages/admin-portal/src/app/analytics/page.tsx following App Router patterns with server component data fetching [Source: architecture/nextjs-admin-portal-architecture.md:47-52]
- **Chart Components**: TrendChart, AttackVectorChart, UserEngagementPanel using Chart.js/Recharts for interactive visualizations [Source: architecture/nextjs-admin-portal-architecture.md:444-506]
- **Export Tools**: ExportTools component with dropdown selection and download functionality [Source: architecture/nextjs-admin-portal-architecture.md:418-442]
- **Analytics Grid**: AnalyticsGrid component displaying KPI cards with responsive Tailwind CSS layout [Source: architecture/nextjs-admin-portal-architecture.md:415-442]

### File Locations
- **Analytics Pages**: packages/admin-portal/src/app/analytics/ for page.tsx and component organization [Source: architecture/nextjs-admin-portal-architecture.md:47-52]
- **Chart Components**: packages/admin-portal/src/app/analytics/components/ for TrendChart.tsx, ExportTools.tsx, etc. [Source: architecture/nextjs-admin-portal-architecture.md:47-52]
- **API Services**: packages/admin-portal/src/services/AdminAPIService extension for analytics endpoints [Source: architecture/nextjs-admin-portal-architecture.md:298-350]
- **Types**: packages/admin-portal/src/types/analytics.ts for AnalyticsData interface and related types [Source: architecture/nextjs-admin-portal-architecture.md:389-409]
- **Backend Analytics**: packages/backend/src/admin/admin.service.ts extension for analytics business logic [Source: architecture/source-tree.md:44-47]

### Technical Constraints
- **Chart Library**: Use Recharts for interactive visualizations with TypeScript support [Source: architecture/nextjs-admin-portal-architecture.md:444-506]
- **Data Aggregation**: Real-time analytics calculation from existing Report/User tables without separate analytics storage [Source: architecture/tech-stack.md:63-67]
- **Export Formats**: Support PDF, CSV, Excel exports using appropriate libraries (jsPDF, xlsx, csv-writer) [Source: architecture/nextjs-admin-portal-architecture.md:418-442]
- **Spanish Localization**: All analytics labels, chart titles, and export content MUST be in Spanish [Source: architecture/coding-standards.md:22-29]
- **Responsive Design**: Chart components MUST be responsive across desktop, tablet, mobile viewports [Source: architecture/nextjs-admin-portal-architecture.md:564-596]
- **Performance**: Use server components for initial data loading, client components for interactivity [Source: architecture/nextjs-admin-portal-architecture.md:136-214]

### Testing
- **Component Tests**: Jest 29.5.0 for analytics component testing with chart rendering verification [Source: architecture/test-strategy-and-standards.md:10-16]
- **Chart Testing**: Mock chart libraries and test data visualization accuracy and responsiveness [Source: architecture/test-strategy-and-standards.md:17-24]
- **Export Testing**: Test PDF/CSV/Excel generation with sample data and verify format accuracy [Source: architecture/test-strategy-and-standards.md:25-31]
- **API Integration**: Test analytics endpoint integration and data aggregation calculations [Source: architecture/test-strategy-and-standards.md:25-31]
- **Performance Testing**: Verify analytics dashboard loads within 2s response time requirements with large datasets

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-09-20 | 1.0 | Initial story creation for analytics and insights dashboard | Bob (Scrum Master) |